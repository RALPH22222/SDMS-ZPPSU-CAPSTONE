<?php
  $pageTitle = 'Admin Dashboard - SDMS';
  require_once '../../components/admin-head.php';
  require_once '../../database/database.php';
  function fetchScalar($pdo, $sql, $params = []) {
    $stmt = $pdo->prepare($sql);
    $stmt->execute($params);
    $val = $stmt->fetchColumn();
    return $val ? (int)$val : 0;
  }
  $totalUsers = fetchScalar($pdo, "SELECT COUNT(*) FROM users");
  $activeUsers = fetchScalar($pdo, "SELECT COUNT(*) FROM users WHERE is_active = 1");
  $inactiveUsers = $totalUsers - $activeUsers;
  $roleCount = fetchScalar($pdo, "SELECT COUNT(*) FROM roles");
  $violationCategories = fetchScalar($pdo, "SELECT COUNT(*) FROM violation_categories");
  $violationTypes = fetchScalar($pdo, "SELECT COUNT(*) FROM violation_types");
  $teacherCount = fetchScalar($pdo, "SELECT COUNT(*) FROM staff");
  $totalCases = fetchScalar($pdo, "SELECT COUNT(*) FROM cases");
  $resolvedCases = fetchScalar($pdo, "SELECT COUNT(*) FROM cases WHERE status_id = 4");
  $openCases = $totalCases - $resolvedCases;
  $notificationCount = fetchScalar($pdo, "SELECT COUNT(*) FROM notifications");
  $auditTrailCount = fetchScalar($pdo, "SELECT COUNT(*) FROM audit_trail");
  $casesByStatus = [];
  $stmt = $pdo->query("
    SELECT cs.name AS status_name, COUNT(c.id) AS cnt
    FROM case_status cs
    LEFT JOIN cases c ON c.status_id = cs.id
    GROUP BY cs.id, cs.name
    ORDER BY cs.id
  ");
  while ($row = $stmt->fetch(PDO::FETCH_ASSOC)) {
    $casesByStatus[] = $row;
  }
  $casesPerMonth = [];
  $stmt = $pdo->query("
    SELECT DATE_FORMAT(incident_date, '%Y-%m') AS ym, COUNT(*) AS cnt
    FROM cases
    WHERE incident_date >= DATE_SUB(CURDATE(), INTERVAL 6 MONTH)
    GROUP BY ym
    ORDER BY ym
  ");
  while ($row = $stmt->fetch(PDO::FETCH_ASSOC)) {
    $casesPerMonth[$row['ym']] = (int)$row['cnt'];
  }
  $topCategories = [];
  $stmt = $pdo->query("
    SELECT vc.name AS category, COUNT(c.id) AS cnt
    FROM violation_categories vc
    LEFT JOIN violation_types vt ON vt.category_id = vc.id
    LEFT JOIN cases c ON c.violation_type_id = vt.id
    GROUP BY vc.id, vc.name
    ORDER BY cnt DESC
    LIMIT 5
  ");
  while ($row = $stmt->fetch(PDO::FETCH_ASSOC)) {
    $topCategories[] = $row;
  }
  $statusLabels = array_map(fn($r) => $r['status_name'], $casesByStatus);
  $statusCounts = array_map(fn($r) => (int)$r['cnt'], $casesByStatus);
  $monthLabels = [];
  $monthCounts = [];
  for ($i = 5; $i >= 0; $i--) {
    $ym = date('Y-m', strtotime("-$i months"));
    $monthLabels[] = date('M Y', strtotime("$ym-01"));
    $monthCounts[] = $casesPerMonth[$ym] ?? 0;
  }

  $catLabels = array_map(fn($r) => $r['category'], $topCategories);
  $catCounts = array_map(fn($r) => (int)$r['cnt'], $topCategories);
?>

<div class="min-h-screen md:pl-64">
  <div class="md:hidden sticky top-0 z-40 bg-white border-b border-gray-200">
    <div class="h-16 flex items-center px-4">
      <button id="adminSidebarToggle" class="text-primary text-2xl mr-3">
        <i class="fa-solid fa-bars"></i>
      </button>
      <div class="text-primary font-bold">Admin Dashboard</div>
    </div>
  </div>

  <?php include '../../components/admin-sidebar.php'; ?>

  <main class="px-4 md:px-8 py-6">
    <div class="flex items-center gap-3 mb-6">
      <i class="fa-solid fa-gauge text-primary text-2xl"></i>
      <h1 class="text-2xl md:text-3xl font-bold text-primary">Dashboard</h1>
    </div>
    <section class="grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-3 xl:grid-cols-4 gap-4 sm:gap-6 mb-6 sm:mb-8 px-2 sm:px-0">
      <div class="bg-white border border-gray-200 rounded-lg p-5 shadow-sm hover:shadow transition">
        <div class="flex items-center justify-between mb-4">
          <h3 class="font-semibold text-dark">Manage Users</h3>
          <i class="fa-solid fa-users text-primary text-xl"></i>
        </div>
        <div class="text-3xl font-bold text-primary mb-1"><?php echo $totalUsers; ?></div>
        <div class="text-sm text-gray">Active: <?php echo $activeUsers; ?> • Inactive: <?php echo $inactiveUsers; ?></div>
        <a href="manage-user.php" class="text-sm text-primary hover:underline mt-3 inline-block">Go to Users</a>
      </div>
      <div class="bg-white border border-gray-200 rounded-lg p-5 shadow-sm hover:shadow transition">
        <div class="flex items-center justify-between mb-4">
          <h3 class="font-semibold text-dark">Roles & Permissions</h3>
          <i class="fa-solid fa-user-shield text-primary text-xl"></i>
        </div>
        <div class="text-3xl font-bold text-primary mb-1"><?php echo $roleCount; ?></div>
        <div class="text-sm text-gray">Total roles</div>
      </div>
      <div class="bg-white border border-gray-200 rounded-lg p-5 shadow-sm hover:shadow transition">
        <div class="flex items-center justify-between mb-4">
          <h3 class="font-semibold text-dark">Violation Categories</h3>
          <i class="fa-solid fa-triangle-exclamation text-primary text-xl"></i>
        </div>
        <div class="text-3xl font-bold text-primary mb-1"><?php echo $violationCategories; ?></div>
        <div class="text-sm text-gray">Types: <?php echo $violationTypes; ?></div>
      </div>
      <div class="bg-white border border-gray-200 rounded-lg p-5 shadow-sm hover:shadow transition">
        <div class="flex items-center justify-between mb-4">
          <h3 class="font-semibold text-dark">Teachers</h3>
          <i class="fa-solid fa-chalkboard-user text-primary text-xl"></i>
        </div>
        <div class="text-3xl font-bold text-primary mb-1"><?php echo $teacherCount; ?></div>
        <div class="text-sm text-gray">Assigned via classes</div>
        <a href="manage-teachers.php" class="text-sm text-primary hover:underline mt-3 inline-block">Manage Teachers</a>
      </div>
      <div class="bg-white border border-gray-200 rounded-lg p-5 shadow-sm hover:shadow transition">
        <div class="flex items-center justify-between mb-4">
          <h3 class="font-semibold text-dark">All Cases</h3>
          <i class="fa-solid fa-folder-open text-primary text-xl"></i>
        </div>
        <div class="text-3xl font-bold text-primary mb-1"><?php echo $totalCases; ?></div>
        <div class="text-sm text-gray">Open: <?php echo $openCases; ?> • Resolved: <?php echo $resolvedCases; ?></div>
        <a href="manage-cases.php" class="text-sm text-primary hover:underline mt-3 inline-block">View & Filter</a>
      </div>
      <div class="bg-white border border-gray-200 rounded-lg p-5 shadow-sm hover:shadow transition">
        <div class="flex items-center justify-between mb-4">
          <h3 class="font-semibold text-dark">Reports & Export</h3>
          <i class="fa-solid fa-file-export text-primary text-xl"></i>
        </div>
        <div class="text-3xl font-bold text-primary mb-1">—</div>
        <div class="text-sm text-gray">Generate reports, export data</div>
      </div>
      <div class="bg-white border border-gray-200 rounded-lg p-5 shadow-sm hover:shadow transition">
        <div class="flex items-center justify-between mb-4">
          <h3 class="font-semibold text-dark">Audit Trail</h3>
          <i class="fa-solid fa-list-check text-primary text-xl"></i>
        </div>
        <div class="text-3xl font-bold text-primary mb-1"><?php echo $auditTrailCount; ?></div>
        <div class="text-sm text-gray">Total audit events</div>
        <a href="../Admin/activity-log.php" class="text-sm text-primary hover:underline mt-3 inline-block">View Audit Trail</a>
      </div>
      <div class="bg-white border border-gray-200 rounded-lg p-5 shadow-sm hover:shadow transition">
        <div class="flex items-center justify-between mb-4">
          <h3 class="font-semibold text-dark">Notifications</h3>
          <i class="fa-solid fa-bell text-primary text-xl"></i>
        </div>
        <div class="text-3xl font-bold text-primary mb-1"><?php echo $notificationCount; ?></div>
        <div class="text-sm text-gray">Unread and sent</div>
        <a href="manage-notification.php" class="text-sm text-primary hover:underline mt-3 inline-block">Manage Notifications</a>
      </div>
    </section>
    <section class="grid grid-cols-1 lg:grid-cols-3 gap-4 sm:gap-6 px-2 sm:px-0">
      <div class="bg-white border border-gray-200 rounded-lg p-4 sm:p-5 shadow-sm h-full">
        <h3 class="font-semibold text-dark mb-4">Cases by Status</h3>
        <canvas id="chartStatus" height="200"></canvas>
      </div>

      <div class="bg-white border border-gray-200 rounded-lg p-4 sm:p-5 shadow-sm lg:col-span-2 h-full">
        <h3 class="font-semibold text-dark mb-4">Cases per Month (Last 6 Months)</h3>
        <canvas id="chartMonthly" height="200"></canvas>
      </div>

      <div class="bg-white border border-gray-200 rounded-lg p-5 shadow-sm lg:col-span-3">
        <h3 class="font-semibold text-dark mb-4">Top Violation Categories</h3>
        <canvas id="chartCategories" height="120"></canvas>
      </div>
    </section>
  </main>
</div>

<script>
  const statusLabels = <?php echo json_encode($statusLabels); ?>;
  const statusCounts = <?php echo json_encode($statusCounts); ?>;
  const monthLabels = <?php echo json_encode($monthLabels); ?>;
  const monthCounts = <?php echo json_encode($monthCounts); ?>;
  const catLabels = <?php echo json_encode($catLabels); ?>;
  const catCounts = <?php echo json_encode($catCounts); ?>;
  const colorPrimary = '#800000';
  const colorSecondary = '#a52a2a';
  const palette = ['#800000','#a52a2a','#d2691e','#6c757d','#333333','#f5a623','#50e3c2','#4a90e2'];
  const ctxStatus = document.getElementById('chartStatus').getContext('2d');
  new Chart(ctxStatus, {
    type: 'doughnut',
    data: {
      labels: statusLabels,
      datasets: [{
        data: statusCounts,
        backgroundColor: palette.slice(0, statusCounts.length),
        borderWidth: 1
      }]
    },
    options: {
      plugins: { legend: { position: 'bottom' } }
    }
  });
  const ctxMonthly = document.getElementById('chartMonthly').getContext('2d');
  new Chart(ctxMonthly, {
    type: 'line',
    data: {
      labels: monthLabels,
      datasets: [{
        label: 'Cases',
        data: monthCounts,
        borderColor: colorPrimary,
        backgroundColor: colorPrimary + '33',
        tension: 0.3,
        fill: true
      }]
    },
    options: {
      plugins: { legend: { display: false } },
      scales: { y: { beginAtZero: true, ticks: { precision: 0 } } }
    }
  });
  const ctxCategories = document.getElementById('chartCategories').getContext('2d');
  new Chart(ctxCategories, {
    type: 'bar',
    data: {
      labels: catLabels,
      datasets: [{
        label: 'Cases',
        data: catCounts,
        backgroundColor: colorSecondary
      }]
    },
    options: {
      plugins: { legend: { display: false } },
      scales: { y: { beginAtZero: true, ticks: { precision: 0 } } }
    }
  });
</script>

<?php include_once __DIR__ . '/../../components/admin-footer.php'; ?>                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                   